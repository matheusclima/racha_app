{% extends 'topnav.html' %}

{% block content %}
<html>

<head>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/select_team.css') }}">
</head>

<body>
    {% set team_letters = ["A", "B", "C", "D"] %}
    {% set bg_color = ["white", "orange", "black", "lightgreen"] %}
    <div page id="page2">

        <form action="" method="POST" style="height: inherit; padding-left: 50px; padding-top: 15px;">
            <input change-page class="btn" type="button" value="Voltar">
            <input class="btn" type="button" value="Adicionar partida">

            <div style="height: 330px; padding-bottom: 20px;">
                <select id="select_match" size="12" style="float: left; margin-top: 25px;">
                    <option>A x B</option>
                    <option>B x A</option>
                </select>
                {% for k in range(2) %}
                <table match class="team-table" style="margin-right: 10px; display: none;">
                    <tr>
                        <div class="team_container" style="display: inline-block;">
                            <th rowspan="7">
                                <h3 team class="rotate-text"></h3>
                            </th>
                        </div>
                        <th class="team-player">Jogador</th>
                        <th class="team-match">Gols</th>
                    </tr>
                    {% for i in range(2) %}
                    <tr>
                        <td players class="team-player" style="font-weight: bold;"></td>
                        <td class="team-match">
                            <input type="number" class="goal-field" name="stats" min="0" value="0">
                        </td>
                    </tr>
                    {% endfor %}
                </table>
                {% endfor %}
            </div>
        </form>
    </div>
    <script>

        var teamsObject = {}
        var matchesObject = {}

        const pages = document.querySelectorAll('[page]')
        
        document.getElementById('select_match').onchange = function (e) {

            const matchSelector = e.target
            const form = matchSelector.parentNode.parentNode
            const formData = new FormData(form)
            const h3Content = document.querySelectorAll('[team]')
            const table = document.querySelectorAll('[match]')
            const bgColors = {
                "A": "white",
                "B": "orange",
                "C": "black",
                "D": "lightgreen"
            }
            
            teamsObject = JSON.parse('{{ teams|tojson|safe }}')
            console.log(teamsObject)
            var matchInfo = matchSelector.value,
                home = matchInfo[0],
                away = matchInfo[matchInfo.length - 1];
    
            var match = [home, away]

            for (var i = 0; i < match.length; i++) {
                table[i].style.display = 'table'
                h3Content[i].parentNode.style['background-color'] = bgColors[match[i]]
                h3Content[i].innerHTML = 'Time ' + match[i]
                
                for (var j = 0; j < teamsObject[match[i]].players.length; j++) {
                    index = j + 2 * i
                    document.querySelectorAll('[players]')[index].innerHTML = teamsObject[match[i]].players[j].name
                }
            }

            for (let data of formData) {
                console.log(data, index)
            }
            form.reset()
        }

    </script>
</body>

</html>
{% endblock %}